Restored database functionality with proper error handling